apply plugin: "io.gitlab.arturbosch.detekt"

// avaliacao no momento de build for ser executada.
// ela depende do detekt
// antes de executar o pre build, pedimos pra ele executar o detekt
// toda vida que fizemos o build do nosso projeto ele vai rodar essa task detekt
// automaticamente
project.afterEvaluate {
    tasks.named("preBuild") {
        dependsOn("detekt")
    }
}

detekt {
    toolVersion = "$detekt_version"

    // util pra projetos que tem mais de um modulo
    // detekt vai fazer analise de codigo em todos os modulos
    def inputDirFiles = []
    // subprojects sao modulos
    // pra cada um desses modulos
    // eu estou orientando aqui qual que e o diretorio que ele precisa analisar esse
    // codigo
    rootProject.subprojects.each { module ->
        inputDirFiles << "$module.projectDir/src/main/java"

    }
    // dps eu informo ao detect esses arquivos
    source = files(inputDirFiles)
    config = files("$rootDir/config/detekt/detekt.yml")
    autoCorrect = true
    // auto correct = true
    // vai corrigir algumas coisinhas simples que ele encontrar
    // se ele encontrar algo simples de acordo com as regras ele mesmo vai corrigir
//    baseline = file("$projectDir/config/baseline.xml")


    reports {
        xml {
            enabled = true
            destination = file("$buildDir/reports/detekt/detekt.xml")
        }
        html {
            enabled = true
            destination = file("$buildDir/reports/detekt/detekt.html")

        }
        txt {
            enabled = true
            destination = file("$buildDir/reports/detekt/detekt.txt")

        }
    }
}